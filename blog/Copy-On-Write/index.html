<!DOCTYPE html><html lang="en"><head><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet"/><script src="https://kit.fontawesome.com/662f6d0c39.js" crossorigin="anonymous"></script><script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/></head><head><meta charset="UTF-8"/><meta name="og:site_name" content="Jihoonahn Blog"/><link rel="canonical" href="https://blog.jihoon.me/blog/Copy-On-Write"/><meta name="twitter:url" content="https://blog.jihoon.me/blog/Copy-On-Write"/><meta name="og:url" content="https://blog.jihoon.me/blog/Copy-On-Write"/><title>Copy On Write | Jihoonahn Blog</title><meta name="twitter:title" content="Copy On Write | Jihoonahn Blog"/><meta name="og:title" content="Copy On Write | Jihoonahn Blog"/><meta name="description" content="Copy On Write가 뭔지 알아봅시다."/><meta name="twitter:description" content="Copy On Write가 뭔지 알아봅시다."/><meta name="og:description" content="Copy On Write가 뭔지 알아봅시다."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/static/styles/default_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/header_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/about_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/post_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/sectionPage_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/errorPage_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/footer_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/tag_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/tagDetail_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/pagination_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/nextAndPreview_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/docsearch_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/home_style.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Jihoonahn Blog"/></head><body><header id="blog-head" class="blog-head outer"><div class="blog-head-inner inner"><div class="blog-head-brand"><div class="menu-icon-container"><div class="menu-icon"><span class="line-1"></span><span class="line-2"></span></div></div><a href="/" class="blog-head-logo"><img src="/static/images/Icon/icon.svg" alt="Jihoonahn Blog"/></a><div class="DocSearch-Button-container"><div id="docsearch" class="blog-search blog-icon-btn"></div></div></div><nav class="blog-head-menu"><ul class="nav"><li><a href="/blog" class="nav-item">Blog</a></li><li><a href="/about" class="nav-item">About</a></li></ul></nav></div><script src="/static/scripts/Header/header-scroll.js"></script><script src="/static/scripts/Header/header-menu.js"></script><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script><script type="text/javascript" src="/static/scripts/Doc_Search/DocSearch.js"></script></header><div class="wrapper"><article><header class="site-post-head"><div class="site-post-head-image" style="background-image: url(/static/images/Blog/blog/Copy-On-Write.svg)"></div></header><div class="site-post-head-title"><h1>Copy On Write</h1><section class="site-post-full-meta"><time>2023.02.15</time><span class="date-divider">|</span><a href="https://blog.jihoon.me/tags/swift">Swift. </a><a href="https://blog.jihoon.me/tags/theory">Theory. </a><a href="https://blog.jihoon.me/tags/memory">Memory. </a></section></div><div class="site-post-body"><div><p>오늘은 COW (Copy On Write) 에 대해서 배워 볼 것입니다. 개발할 때 꼭 알아야 하는 지식이기 때문에, 이번에 정리해보려고 합니다.</p><p>일단 시작해보겠습니다!</p><hr><p>Swift 문서상에서는</p><blockquote><p>복사를 즉각적으로 하지 않고, collection들은 값들이 저장된 메모리를 원본 객체와 복사본들끼리 공유합니다.만약, collection의 복사본들중 하나가 변경되었다면, 수정되기 전에 복사됩니다.</p></blockquote><p>Swift에서 큰 값 타입의 데이터를 변수에 대입하거나 매개변수로 넘기게 되면 매우 비싼 복사 연산이 이루어집니다. 이러한 이슈를 최소화 하기 위해서 Swift 표준 라이브러리는 배열과 같은 몇몇 값 타입에 대해 (두 개 이상의 참조가 있고 변형에 의해서만 복사가 일어납니다.) 하나의 참조만 있으면 복사가 아니라 해당 참조 내에서 값 변경이 일어나는 매커니즘을 설계했습니다.</p><h3>Example</h3><pre><code><span class="keyword">import</span> Foundation

<span class="keyword">func</span> address(o: <span class="type">UnsafeRawPointer</span>) -&gt; <span class="type">Int</span> {
    <span class="keyword">return</span> <span class="type">Int</span>(bitPattern: o)
}

<span class="keyword">var</span> value = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]
<span class="keyword">var</span> copyValue = value

<span class="call">print</span>(<span class="string">"value:</span> \(<span class="call">address</span>(o: &amp;value))<span class="string">"</span>)
<span class="call">print</span>(<span class="string">"copyValue:</span> \(<span class="call">address</span>(o: &amp;copyValue))<span class="string">"</span>)
</code></pre><p>Value Type은 값 복사가 기본적으로 이루어집니다. 예시 코드의 결과 값을 봐봅시다.</p><pre><code>value: <span class="number">105553140417888</span>
copyValue: <span class="number">105553140417888</span>
<span class="type">Program</span> ended with exit code: <span class="number">0</span>
</code></pre><p>결국에 Swift 문서에서 처럼 Collection들은 실제로 값이 바로 복사되지 않고 같은 공간을 share합니다.</p><pre><code>copyValue.<span class="call">append</span>(<span class="number">4</span>)

<span class="call">print</span>(<span class="string">" --&gt; value:</span> \(<span class="call">address</span>(o: &amp;value))<span class="string">"</span>)
<span class="call">print</span>(<span class="string">" --&gt; copyValue:</span> \(<span class="call">address</span>(o: &amp;copyValue))<span class="string">"</span>)
</code></pre><p>변경이 일어났을때 바뀌게 되는지 확인해봅시다.</p><pre><code>value: <span class="number">105553140417888</span>
copyValue: <span class="number">105553150887520</span>
</code></pre><p>Collection Type은 값이 바로 복사가 되지 않고 공유하다가 값의 변경 직전에 Copy되어서 두개로 분리 되는 것을 확인 할 수 있었습니다.</p><hr><h2>OS에서 Copy On Write</h2><p>OS에서는 Copy On Write가 보통 fock()를 수행할 때 적용됩니다.</p><img width = 100% src = "https://www.cs.uic.edu/~jbell/CourseNotes/OperatingSystems/images/Chapter9/9_07_Page_C_Unmodified.jpg"></img><p>process1 과 proccess2로 나누어져 있지만 fork() 개념을 사용하게 되면 process2는 process1의 child process가 될 것 입니다. 이 두개는 같은 영역의 resource를 공유하고 있습니다.</p><img width = 100% src = "https://www.cs.uic.edu/~jbell/CourseNotes/OperatingSystems/images/Chapter9/9_08_Page_C_Modified.jpg"></img><p>parent나 child쪽이 resource를 수정하게 되면 사진처럼 바뀌게 됩니다. 즉 수정된 page C(Copy of page C)를 proccess1이 점유하고 이에 대한 포인터도 기존의 page C를 가리키던 포인터를 Copy of page C를 가리키게끔 변경하면 이로써 Copy On Write가 적용이 됩니다.</p></div></div><div class="nextAndPreview"><div class="preview-container"><a href="/blog/Yackety-Yak-iOS-4" class="preview-link"><div class="preview-textdir"><p>Preview Post</p><h3 class="preview-title">와글와글 제4회 발표 회고록</h3></div></a></div><div class="next-container"><a href="/blog/MVVM" class="next-link"><div class="next-textdir"><p>Next Post</p><h3 class="next-title">MVVM 패턴</h3></div></a></div></div><script src="https://utteranc.es/client.js" repo="JiHoonAHN/Blog" issue-term="pathname" label="comments" theme="github-light" crossorigin="anonymous" async></script></article><script src="/static/scripts/Channel_talk/Channel_talk.js"></script></div><footer class="site-footer"><div class="site-footer__inner"><div class="copyright"><div><p>Copyright © <a href="https://github.com/jihoonahn">Jihoonahn</a></p></div><div><p>Made with Swift</p></div></div><div class="social"><ul><li class="social_link"><a href="https://github.com/Jihoonahn"><i class="fa-brands fa-github"></i></a></li><li class="social_link"><a href="https://www.linkedin.com/in/ahnjihoon/"><i class="fa-brands fa-linkedin-in"></i></a></li><li class="social_link"><a href="https://twitter.com/jihoon_dev"><i class="fa-brands fa-twitter"></i></a></li><li class="social_link"><a href="mailto:official@jihoon.me"><i class="fa-solid fa-envelope"></i></a></li><li class="social_link"><a href="https://blog.jihoon.me/feed.rss"><i class="fa-solid fa-rss"></i></a></li></ul></div></div></footer></body></html>