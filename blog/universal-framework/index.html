<!DOCTYPE html><html><head><meta charset="UTF-8"/><meta name="og:site_name" content="jihoon.me"/><link rel="canonical" href="https://blog.jihoon.me/blog/universal-framework"/><meta name="twitter:url" content="https://blog.jihoon.me/blog/universal-framework"/><meta name="og:url" content="https://blog.jihoon.me/blog/universal-framework"/><title>Universal Framework</title><meta name="twitter:title" content="Universal Framework"/><meta name="og:title" content="Universal Framework"/><meta name="description" content="Universal Framework에 대한 공부"/><meta name="twitter:description" content="Universal Framework에 대한 공부"/><meta name="og:description" content="Universal Framework에 대한 공부"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/><link rel="stylesheet" href="styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to jihoon.me"/></head><body><header id="header" class="fixed top-0 left-0 w-full z-20 bg-blog-c-nav backdrop-saturate-125 backdrop-blur-xl"><div class="pl-6 pr-4"><div class="flex justify-between mx-auto my-0 max-w-3xl"><a href="/" class="flex items-center h-blog-nav"><img src="/static/images/icon.svg" class="max-h-11 p-0"/></a><div class="flex justify-end items-center grow"><div class="flex items-center pl-4"><div id="docsearch" class="blogDocsearch"></div></div><button id="mobileNavButton" aria-label="Mobile navigation" class="cursor-pointer flex w-10 h-blog-nav items-center justify-center group md:hidden"><span class="relative h-4 w-4 overflow-hidden"><span class="transition duration-200 top-0 left-0 absolute w-full h-0.5 bg-blog-c-nav-text ease translate-x-0 translate-y-0 group-[.expanded]:rotate-45 group-[.expanded]:translate-y-0 group-[.expanded]:top-1.5"></span><span class="transition duration-200 top-1.5 left-0 absolute w-full h-0.5 bg-blog-c-nav-text ease translate-x-0 translate-y-0 group-[.expanded]:opacity-0"></span><span class="transition duration-200 top-3 left-0 absolute w-full h-0.5 bg-blog-c-nav-text ease translate-x-0 translate-y-0 group-[.expanded]:-rotate-45 group-[.expanded]:-translate-y-0 group-[.expanded]:top-1.5"></span></span></button></div><nav class="hidden md:flex"><ul class="flex list-none m-0"><li><a href="/blog" class="blogNavBarMenuLink block py-0 px-3 text-xs leading-calc-blog-nav">Blog</a></li><li><a href="/about" class="blogNavBarMenuLink block py-0 px-3 text-xs leading-calc-blog-nav">About</a></li></ul></nav></div><div id="blogNavScreen" class="hidden h-screen"><div class="my-0 mx-auto max-w-[288px] pt-6 pb-24"><nav class="inline"><ul class="list-none m-0"><li><a href="/blog" class="block py-3 blogNavBarMenuLink border-b border-zinc-500 border-solid">Blog</a></li><li><a href="/about" class="block py-3 blogNavBarMenuLink border-b border-zinc-500 border-solid">About</a></li></ul></nav><div class="mt-4 w-full"><ul class="flex justify-center gap-4 list-none"><li><a href="https://github.com/jihoonahn" class="text-center w-6 h-6"><img src="/static/icons/github.svg" class="w-6 h-6 rounded-none"/></a></li><li><a href="https://www.linkedin.com/in/ahnjihoon/" class="text-center w-6 h-6"><img src="/static/icons/linkedin.svg" class="w-6 h-6 rounded-none"/></a></li><li><a href="mailto:jihoonahn.dev@gmail.com" class="text-center w-6 h-6"><img src="/static/icons/envelope-solid.svg" class="w-6 h-6 rounded-none"/></a></li><li><a href="https://blog.jihoon.me/feed.rss" class="text-center w-6 h-6"><img src="/static/icons/rss-solid.svg" class="w-6 h-6 rounded-none"/></a></li></ul></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script><script src="/static/scripts/header.js"></script><script type="text/javascript" src="/static/scripts/docSearch.js"></script></header><main id="main" class="relative z-10 flex flex-1 flex-col min-h-screen pt-20 pb-14"><section><article><div><div class="component md:w-[654px]"><div><time class="text-gray-500 text-sm">2023년 04월 02일</time></div></div><div class="component md:w-[654px]"><div><h1 class="font-semibold text-heading-2 md:text-heading-1">Universal Framework</h1></div></div><div class="component md:w-[654px]"><div class="text-lg md:text-2xl mx-auto">Universal Framework에 대한 공부</div></div></div><figure class="component rounded-xl overflow-hidden min-w-[85%] lg:min-w-[320px]"><div><img src="https://github.com/jihoonahn/blog/assets/68891494/0467f741-a648-48b0-bbb5-1daa24fd9280" class="p-0"/></div></figure><div class="mx-auto w-[85%] text-left mt-8 md:w-[700px]"><div><h2>Universal Framework (범용 프레임워크)</h2><p>디바이스와 시뮬레이터에서 사용가능하도록 범용적으로 프레임워크를 만드는 것입니다. <br/> Device에서의 OS, SimulatorOS 둘 모두에 적용하기 위해서는 Valid Architecture가 모두 존재해야합니다. iPhone OS에서의 CPU와, macOS에서의 경우 시뮬레이터의 구동을 위해서는 macOS의 CPU가 구현되어 맞춰줘야 합니다. <br/></p><p>이러한 문제점을 해결하기 위해서 나온 것이 Universal Framework입니다. <br/></p><h3>Universal Framework 의 장점</h3><ul><li>코드 재사용성이 올라간다.</li><li>코드 숨기가 쉬워진다.</li><li>코드 모듈화에 이점을 갖는다.</li><li>쉬운 통합이 가능하다.</li><li>쉽게 배포할 수 있다.</li></ul><h3>사용법</h3><p>Target 아래쪽에 있는 + 버튼을 누릅니다. 그 후 Other -&gt; Aggregate를 추가합니다. (Framework와 XCFramework 둘다 생성해줍니다.)</p><img width="100%" src="https://user-images.githubusercontent.com/68891494/230734262-75b7f72f-2fcb-4e3c-b4ab-540aef965dbe.png"></img><img width="49%" src="https://user-images.githubusercontent.com/68891494/230734362-64553040-5617-4c18-88b3-fda6d5e38cdc.png"></img><img width="49%" src="https://user-images.githubusercontent.com/68891494/230734363-8b0e9098-a026-4ed1-8ef8-aa298ecf3c5c.png"></img><br/><h2>Add Script</h2><p>각각의 Aggregate에 Script를 추가해줍니다.</p><img width="49%" src="https://user-images.githubusercontent.com/68891494/230735301-2f7b56e2-f9d7-4265-b4a6-53f4faa975f2.png"></img><img width="49%" src="https://user-images.githubusercontent.com/68891494/230735305-e7f7eb72-bdec-4032-af50-554bdc78fafb.png"></img><h4>XCFramework</h4><pre><code class="language-shell"># Build Device and Simulator versions
xcodebuild archive -scheme "${PROJECT_NAME}" -archivePath "${BUILD_DIR}/iphoneos.xcarchive" -sdk iphoneos SKIP_INSTALL=NO BUILD_LIBRARY_FOR_DISTRIBUTION=YES
xcodebuild archive -scheme "${PROJECT_NAME}" -archivePath "${BUILD_DIR}/iphonesimulator.xcarchive" -sdk iphonesimulator SKIP_INSTALL=NO BUILD_LIBRARY_FOR_DISTRIBUTION=YES

xcodebuild -create-xcframework \
    -framework "${BUILD_DIR}/iphoneos.xcarchive/Products/Library/Frameworks/"${PROJECT_NAME}".framework" \
    -framework "${BUILD_DIR}/iphonesimulator.xcarchive/Products/Library/Frameworks/"${PROJECT_NAME}".framework" \
    -output "${BUILD_DIR}/"${PROJECT_NAME}".xcframework"

    
# Copy the xcframework to the project directory
cp -R "${BUILD_DIR}/"${PROJECT_NAME}".xcframework" "${PROJECT_DIR}"

# Open the project directory in Finder
open "${PROJECT_DIR}"
</code></pre><h4>Framework</h4><pre><code>UNIVERSAL_OUTPUTFOLDER=${BUILD_DIR}/${CONFIGURATION}-Universal
  
# Make sure the output directory exists
mkdir -p "${UNIVERSAL_OUTPUTFOLDER}"
  
# Build Device and Simulator versions
xcodebuild -target "${PROJECT_NAME}" BITCODE_GENERATION_MODE=bitcode OTHER_CFLAGS="-fembed-bitcode" ONLY_ACTIVE_ARCH=NO -configuration ${CONFIGURATION} -sdk iphonesimulator BUILD_DIR="${BUILD_DIR}" BUILD_ROOT="${BUILD_ROOT}" clean build
xcodebuild -target "${PROJECT_NAME}" BITCODE_GENERATION_MODE=bitcode OTHER_CFLAGS="-fembed-bitcode" ONLY_ACTIVE_ARCH=NO -configuration ${CONFIGURATION} -sdk iphoneos  BUILD_DIR="${BUILD_DIR}" BUILD_ROOT="${BUILD_ROOT}" clean build
  
  
# Copy the framework structure (from iphoneos build) to the universal folder
cp -R "${BUILD_DIR}/${CONFIGURATION}-iphoneos/${PROJECT_NAME}.framework" "${UNIVERSAL_OUTPUTFOLDER}/"
  
# Copy Swift modules from iphonesimulator build (if it exists) to the copied framework directory
cp -R "${BUILD_DIR}/${CONFIGURATION}-iphonesimulator/${PROJECT_NAME}.framework/Modules/${PROJECT_NAME}.swiftmodule/." "${UNIVERSAL_OUTPUTFOLDER}/${PROJECT_NAME}.framework/Modules/${PROJECT_NAME}.swiftmodule"
  
# Create universal binary file using lipo and place the combined executable in the copied framework directory
lipo -create "${BUILD_DIR}/${CONFIGURATION}-iphonesimulator/${PROJECT_NAME}.framework/${PROJECT_NAME}" "${BUILD_DIR}/${CONFIGURATION}-iphoneos/${PROJECT_NAME}.framework/${PROJECT_NAME}" -output "${UNIVERSAL_OUTPUTFOLDER}/${PROJECT_NAME}.framework/${PROJECT_NAME}"
  
# Copy the framework to the project directory
cp -R "${UNIVERSAL_OUTPUTFOLDER}/${PROJECT_NAME}.framework" "${PROJECT_DIR}"
  
# Open the project directory in Finder
open "${PROJECT_DIR}"
</code></pre><br/><h2>Run</h2><img width="50%" src="https://user-images.githubusercontent.com/68891494/230735382-bb57dcae-094d-41fd-bbac-a67d58238720.png"></img><p>각각 원하는 Aggregate Scheme를 선택하고 빌드하면 됩니다.</p><img width="49%" src="https://user-images.githubusercontent.com/68891494/230735710-e91d3125-07ac-4725-a878-64c378dcfa28.png"></img><img width="49%" src="https://user-images.githubusercontent.com/68891494/230735711-ad3a28d2-a6c9-4d8f-a44a-b6ac63ebfaa8.png"></img><p>좌 Framework Aggregate로 빌드 했을 때, 우 XCFramework Aggregate로 빌드 했을 때</p><br/><h2>Reference</h2><ul><li><a href="https://magicmon.tistory.com/225">tistory</a></li><li><a href="https://medium.com/macoclock/swift-universal-framework-3bc858224a7c">medium</a></li><li><a href="https://github.com/kstenerud/iOS-Universal-Framework">kstenerud/iOS-Universal-Framework</a></li></ul></div></div><div class="flex flex-col-reverse px-4 mt-11 mb-4 max-w-3xl mx-auto md:flex-row md:px-0"><div class="min-w-0 flex-1 mt-4 md:mt-0"><a href="/blog/scade-introduce" class="flex cursor-pointer rounded-[10px] bg-blog-c-preview-page w-full h-full p-4 min-h-[4.2rem] items-center"><div class="flex-1 flex flex-col leading-none min-w-0 items-start"><p class="text-gray-500 m-0.5">Preview Post</p><h3 class="text-black text-2xl font-medium m-0.5">Scade 소개</h3></div></a></div><div class="min-w-0 flex-1 mt-4 md:mt-0 md:ml-8"><a href="/blog/tuist-xcodebeta" class="flex cursor-pointer bg-blog-c-preview-page w-full h-full rounded-[10px] p-4 flex-row-reverse items-center min-h-[4.2rem]"><div class="flex-1 flex flex-col leading-none min-w-0 items-end"><p class="text-gray-500 m-0.5">Next Post</p><h3 class="text-black text-2xl font-medium m-0.5">Xcode-Beta에서 Tuist 사용기</h3></div></a></div></div><script src="https://utteranc.es/client.js" repo="jihoonahn/blog" issue-term="pathname" label="comments" theme="github-light" crossorigin="anonymous" async></script></article></section></main><footer class="bg-blog-c-footer relative"><div class="flex flex-wrap justify-between p-1 mx-auto max-w-4xl"><div class="text-sm mx-3 my-auto p-2"><div><p class="text-stone-600 my-0">Copyright © <a href="https://github.com/jihoonahn" class="text-stone-700">Jihoonahn</a></p></div><div><p class="text-stone-600 my-0">Made with Swift</p></div></div><div class="mx-2"><ul class="inline-flex gap-4 list-none"><li class="text-center w-4 h-4"><a href="https://github.com/jihoonahn"><img src="/static/icons/github.svg" class="w-full h-auto rounded-none"/></a></li><li class="text-center w-4 h-4"><a href="https://www.linkedin.com/in/ahnjihoon/"><img src="/static/icons/linkedin.svg" class="w-full h-auto rounded-none"/></a></li><li class="text-center w-4 h-4"><a href="mailto:jihoonahn.dev@gmail.com"><img src="/static/icons/envelope-solid.svg" class="w-full h-auto rounded-none"/></a></li><li class="text-center w-4 h-4"><a href="https://blog.jihoon.me/feed.rss"><img src="/static/icons/rss-solid.svg" class="w-full h-auto rounded-none"/></a></li></ul></div></div></footer></body></html>