<!DOCTYPE html><html lang="en"><head><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet"/><script src="https://kit.fontawesome.com/662f6d0c39.js" crossorigin="anonymous"></script><script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/></head><head><meta charset="UTF-8"/><meta name="og:site_name" content="Jihoon.me"/><link rel="canonical" href="https://blog.jihoon.me/blog/universal-framework"/><meta name="twitter:url" content="https://blog.jihoon.me/blog/universal-framework"/><meta name="og:url" content="https://blog.jihoon.me/blog/universal-framework"/><title>Universal Framework | Jihoon.me</title><meta name="twitter:title" content="Universal Framework | Jihoon.me"/><meta name="og:title" content="Universal Framework | Jihoon.me"/><meta name="description" content="Universal Framework에 대한 공부"/><meta name="twitter:description" content="Universal Framework에 대한 공부"/><meta name="og:description" content="Universal Framework에 대한 공부"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/static/styles/default_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/header_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/about_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/post_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/sectionPage_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/errorPage_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/footer_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/tag_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/tagDetail_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/pagination_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/nextAndPreview_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/docsearch_style.css" type="text/css"/><link rel="stylesheet" href="/static/styles/home_style.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Jihoon.me"/></head><body><header id="blog-head" class="blog-head outer"><div class="blog-head-inner inner"><div class="blog-head-brand"><div class="menu-icon-container"><div class="menu-icon"><span class="line-1"></span><span class="line-2"></span></div></div><a href="/" class="blog-head-logo"><img src="/static/images/Icon/icon.svg" alt="Jihoonahn Blog"/></a><div class="DocSearch-Button-container"><div id="docsearch" class="blog-search blog-icon-btn"></div></div></div><nav class="blog-head-menu"><ul class="nav"><li><a href="/blog" class="nav-item">Blog</a></li><li><a href="/about" class="nav-item">About</a></li></ul></nav></div><script src="/static/scripts/Header/header-scroll.js"></script><script src="/static/scripts/Header/header-menu.js"></script><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script><script type="text/javascript" src="/static/scripts/Doc_Search/DocSearch.js"></script></header><div class="wrapper"><article><header class="site-post-head"><div class="site-post-head-image" style="background-image: url(https://user-images.githubusercontent.com/68891494/235434676-79ba17d3-06cc-4118-93d9-906fc768d450.svg"></div></header><div class="site-post-head-title"><h1>Universal Framework</h1><section class="site-post-full-meta"><time>2023.04.02</time><span class="date-divider">|</span><a href="https://blog.jihoon.me/tags/swift">Swift. </a><a href="https://blog.jihoon.me/tags/framework">Framework. </a></section></div><div class="site-post-body"><div><p>이번 포스트에서는 Universal Framework에 대해서 공부 해보겠습니다.</p><p>옛날에 Framework를 만들 때 편하게 사용을 해서, 이번 포스트에 담아보는것이 좋겠다고 생각이 들었습니다.</p><p>일단 시작해보겠습니다!</p><hr><h3>Universal Framework (범용 프레임워크)</h3><p>디바이스와 시뮬레이터에서 사용가능하도록 범용적으로 프레임워크를 만드는 것입니다. <br/> Device에서의 OS, SimulatorOS 둘 모두에 적용하기 위해서는 Valid Architecture가 모두 존재해야합니다. iPhone OS에서의 CPU와, macOS에서의 경우 시뮬레이터의 구동을 위해서는 macOS의 CPU가 구현되어 맞춰줘야 합니다. <br/></p><p>이러한 문제점을 해결하기 위해서 나온 것이 Universal Framework입니다. <br/></p><h3>Universal Framework 의 장점</h3><ul><li>코드 재사용성이 올라간다.</li><li>코드 숨기가 쉬워진다.</li><li>코드 모듈화에 이점을 갖는다.</li><li>쉬운 통합이 가능하다.</li><li>쉽게 배포할 수 있다.</li></ul><h3>사용법</h3><p>Target 아래쪽에 있는 + 버튼을 누릅니다. 그 후 Other -&gt; Aggregate를 추가합니다. (Framework와 XCFramework 둘다 생성해줍니다.)</p><img width="100%" src="https://user-images.githubusercontent.com/68891494/230734262-75b7f72f-2fcb-4e3c-b4ab-540aef965dbe.png"></img><img width="49%" src="https://user-images.githubusercontent.com/68891494/230734362-64553040-5617-4c18-88b3-fda6d5e38cdc.png"></img><img width="49%" src="https://user-images.githubusercontent.com/68891494/230734363-8b0e9098-a026-4ed1-8ef8-aa298ecf3c5c.png"></img><br/><h2>Add Script</h2><p>각각의 Aggregate에 Script를 추가해줍니다.</p><img width="49%" src="https://user-images.githubusercontent.com/68891494/230735301-2f7b56e2-f9d7-4265-b4a6-53f4faa975f2.png"></img><img width="49%" src="https://user-images.githubusercontent.com/68891494/230735305-e7f7eb72-bdec-4032-af50-554bdc78fafb.png"></img><h4>XCFramework</h4><pre><code># <span class="type">Build Device</span> and <span class="type">Simulator</span> versions
xcodebuild archive -scheme <span class="string">"${PROJECT_NAME}"</span> -archivePath <span class="string">"${BUILD_DIR}/iphoneos.xcarchive"</span> -sdk iphoneos <span class="type">SKIP_INSTALL</span>=<span class="type">NO BUILD_LIBRARY_FOR_DISTRIBUTION</span>=<span class="type">YES</span>
xcodebuild archive -scheme <span class="string">"${PROJECT_NAME}"</span> -archivePath <span class="string">"${BUILD_DIR}/iphonesimulator.xcarchive"</span> -sdk iphonesimulator <span class="type">SKIP_INSTALL</span>=<span class="type">NO BUILD_LIBRARY_FOR_DISTRIBUTION</span>=<span class="type">YES</span>

xcodebuild -create-xcframework \
    -framework <span class="string">"${BUILD_DIR}/iphoneos.xcarchive/Products/Library/Frameworks/"${PROJECT_NAME}".framework"</span> \
    -framework <span class="string">"${BUILD_DIR}/iphonesimulator.xcarchive/Products/Library/Frameworks/"${PROJECT_NAME}".framework"</span> \
    -output <span class="string">"${BUILD_DIR}/"${PROJECT_NAME}".xcframework"</span>

    
# <span class="type">Copy</span> the xcframework to the project directory
cp -<span class="type">R</span> <span class="string">"${BUILD_DIR}/"${PROJECT_NAME}".xcframework" "${PROJECT_DIR}"</span>

# <span class="type">Open</span> the project directory <span class="keyword">in</span> <span class="type">Finder</span>
<span class="keyword">open</span> <span class="string">"${PROJECT_DIR}"</span>
</code></pre><h4>Framework</h4><pre><code><span class="type">UNIVERSAL_OUTPUTFOLDER</span>=${<span class="type">BUILD_DIR</span>}/${<span class="type">CONFIGURATION</span>}-<span class="type">Universal</span>
  
# <span class="type">Make</span> sure the output directory exists
mkdir -p <span class="string">"${UNIVERSAL_OUTPUTFOLDER}"</span>
  
# <span class="type">Build Device</span> and <span class="type">Simulator</span> versions
xcodebuild -target <span class="string">"${PROJECT_NAME}"</span> <span class="type">BITCODE_GENERATION_MODE</span>=bitcode <span class="type">OTHER_CFLAGS</span>=<span class="string">"-fembed-bitcode"</span> <span class="type">ONLY_ACTIVE_ARCH</span>=<span class="type">NO</span> -configuration ${<span class="type">CONFIGURATION</span>} -sdk iphonesimulator <span class="type">BUILD_DIR</span>=<span class="string">"${BUILD_DIR}"</span> <span class="type">BUILD_ROOT</span>=<span class="string">"${BUILD_ROOT}"</span> clean build
xcodebuild -target <span class="string">"${PROJECT_NAME}"</span> <span class="type">BITCODE_GENERATION_MODE</span>=bitcode <span class="type">OTHER_CFLAGS</span>=<span class="string">"-fembed-bitcode"</span> <span class="type">ONLY_ACTIVE_ARCH</span>=<span class="type">NO</span> -configuration ${<span class="type">CONFIGURATION</span>} -sdk iphoneos  <span class="type">BUILD_DIR</span>=<span class="string">"${BUILD_DIR}"</span> <span class="type">BUILD_ROOT</span>=<span class="string">"${BUILD_ROOT}"</span> clean build
  
  
# <span class="type">Copy</span> the framework structure (from iphoneos build) to the universal folder
cp -<span class="type">R</span> <span class="string">"${BUILD_DIR}/${CONFIGURATION}-iphoneos/${PROJECT_NAME}.framework" "${UNIVERSAL_OUTPUTFOLDER}/"</span>
  
# <span class="type">Copy Swift</span> modules from iphonesimulator build (if it exists) to the copied framework directory
cp -<span class="type">R</span> <span class="string">"${BUILD_DIR}/${CONFIGURATION}-iphonesimulator/${PROJECT_NAME}.framework/Modules/${PROJECT_NAME}.swiftmodule/." "${UNIVERSAL_OUTPUTFOLDER}/${PROJECT_NAME}.framework/Modules/${PROJECT_NAME}.swiftmodule"</span>
  
# <span class="type">Create</span> universal binary file using lipo and place the combined executable <span class="keyword">in</span> the copied framework directory
lipo -create <span class="string">"${BUILD_DIR}/${CONFIGURATION}-iphonesimulator/${PROJECT_NAME}.framework/${PROJECT_NAME}" "${BUILD_DIR}/${CONFIGURATION}-iphoneos/${PROJECT_NAME}.framework/${PROJECT_NAME}"</span> -output <span class="string">"${UNIVERSAL_OUTPUTFOLDER}/${PROJECT_NAME}.framework/${PROJECT_NAME}"</span>
  
# <span class="type">Copy</span> the framework to the project directory
cp -<span class="type">R</span> <span class="string">"${UNIVERSAL_OUTPUTFOLDER}/${PROJECT_NAME}.framework" "${PROJECT_DIR}"</span>
  
# <span class="type">Open</span> the project directory <span class="keyword">in</span> <span class="type">Finder</span>
<span class="keyword">open</span> <span class="string">"${PROJECT_DIR}"</span>
</code></pre><br/><h2>Run</h2><img width="50%" src="https://user-images.githubusercontent.com/68891494/230735382-bb57dcae-094d-41fd-bbac-a67d58238720.png"></img><p>각각 원하는 Aggregate Scheme를 선택하고 빌드하면 됩니다.</p><img width="49%" src="https://user-images.githubusercontent.com/68891494/230735710-e91d3125-07ac-4725-a878-64c378dcfa28.png"></img><img width="49%" src="https://user-images.githubusercontent.com/68891494/230735711-ad3a28d2-a6c9-4d8f-a44a-b6ac63ebfaa8.png"></img><p>좌 Framework Aggregate로 빌드 했을 때, 우 XCFramework Aggregate로 빌드 했을 때</p><br/><h2>Reference</h2><ul><li><a href="https://magicmon.tistory.com/225">tistory</a></li><li><a href="https://medium.com/macoclock/swift-universal-framework-3bc858224a7c">medium</a></li><li><a href="https://github.com/kstenerud/iOS-Universal-Framework">kstenerud/iOS-Universal-Framework</a></li></ul></div></div><div class="nextAndPreview"><div class="preview-container"><a href="/blog/abi" class="preview-link"><div class="preview-textdir"><p>Preview Post</p><h3 class="preview-title">ABI</h3></div></a></div><div class="next-container"><a href="/blog/How-to-use-Tuist-on-Xcode-Beta" class="next-link"><div class="next-textdir"><p>Next Post</p><h3 class="next-title">Xcode-Beta에서 Tuist 사용기</h3></div></a></div></div><script src="https://utteranc.es/client.js" repo="JiHoonAHN/Blog" issue-term="pathname" label="comments" theme="github-light" crossorigin="anonymous" async></script></article><script src="/static/scripts/Channel_talk/Channel_talk.js"></script></div><footer class="site-footer"><div class="site-footer__inner"><div class="copyright"><div><p>Copyright © <a href="https://github.com/jihoonahn">Jihoonahn</a></p></div><div><p>Made with Swift</p></div></div><div class="social"><ul><li class="social_link"><a href="https://github.com/Jihoonahn"><i class="fa-brands fa-github"></i></a></li><li class="social_link"><a href="https://www.linkedin.com/in/ahnjihoon/"><i class="fa-brands fa-linkedin-in"></i></a></li><li class="social_link"><a href="mailto:jihoonahn.dev@gmail.com"><i class="fa-solid fa-envelope"></i></a></li><li class="social_link"><a href="https://blog.jihoon.me/feed.rss"><i class="fa-solid fa-rss"></i></a></li></ul></div></div></footer></body></html>